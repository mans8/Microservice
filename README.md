# Microservice





## 1.构建单体应用模型

​		开发多个模块，打包成一个war包部署在一台服务器。简单、快捷、避免很多和分布式相关的问题。仅适用用户少轻情况。

## 2.走向单体地狱（焦油坑）

正确修复bug和实现新功能变得复杂。

复杂的单体是持续部署的障碍。

单体难以扩展。

可靠性低，一个bug可能拖垮整个进程。

打包部署时间长，发展减缓。

## 3.微服务解决复杂问题

企业开发的复杂即耦合，微服务架构就是解决耦合问题。

一个web应用程序被划分成一组更简单的web应用程序。

一些服务会暴露一个供其它微服务或应用客户端消费的API，其它服务可能实现一个web UI。

实际运行时，每一个服务是一个云虚拟机或者一个docker容器。

服务之间的通信是由API网关负责，API网关负责负载均衡、缓存、访问控制、API计量和监控，可用nginx实现。



### 3.1.SOA架构和微服务架构的区别



 **1.SOA（Service Oriented Architecture）“面向服务的架构”**:他是一种设计方法，其中包含多个服务， 服务之间通过相互依赖最终提供一系列的功能。一个服务 通常以独立的形式存在与操作系统进程中。各个服务之间 通过网络调用。

 **2.微服务架构**:其实**和 SOA 架构类似**,微服务是在 SOA 上做的升华，微服务架构强调的一个重点是“**业务需要彻底的组件化和服务化**”，原有的单个业务系统会拆分为多个可以独立开发、设计、运行的小应用。这些小应用之间通过服务完成交互和集成。

 微服务架构 = 80%的SOA服务架构思想 + 100%的组件化架构思想 + 80%的领域建模思想

## 4.优点

1.解决复杂问题，边界定义明确，单一职责；

2.一个独立的团队专注开发独立服务，可选符合API契约的技术，但更多是用技术选型限制来避免完全混乱状态；

3.实现每个服务的独立部署，持续部署。

4.根据服务实际运行情况，选用最具性价比的硬件。如Compute Optimized实例上部署CPU密集图像处理服务，在Memory Optimized实例上部署一个内存数据库服务。



## 5.缺点

《**没有银弹：软件工程的本质性与附属性工作**》，这篇论文的论述核心是复杂的软件工程无法依靠简单的答案来解决。不要直接向别人要答案，没有直接的答案。

1.微服务是一个分布式系统，其使得整体变得复杂；

2.分区数据库架构；

3.测试微服务应用程序也很复杂；

4.实现了跨越多服务变更；

5.部署微服务应用程序复杂；



## 6.CAP理论和BASE理论

### 6.1CAP理论

​		CAP 理论为：一个分布式系统最多只能同时满足一致性（Consistency）、可用性（Availability）和分区容错性（Partition tolerance）这三项中的两项。

​		2000 年 7 月，加州大学伯克利分校的 Eric Brewer 教授在 ACM PODC 会议上提出 CAP 猜想。2年后，麻省理工学院的 Seth Gilbert 和 Nancy Lynch 从理论上证明了 CAP。之后，CAP 理论正式成为分布式计算领域的公认定理。

​		**一致性（Consistency）**：一致性指 “all nodes see the same data at the same time”，即更新操作成功并返回客户端完成后，所有节点在同一时间的数据完全一致。一致性包含强一致性（通常指这个，一起成功或失败）、弱一致性、顺序一致性。

​		**可用性（Availablility）**：指“Reads and writes always succeed”，即服务一直可用，而且是正常响应时间。

​		**分区容错性（Partition tolerance）**：即分布式系统在遇到某节点或网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务。

强一致性：同时同步数据

最终一致性：允许延时同步数据



### 6.2CAP理论应用

​		对于大多数互联网场景，主机众多、部署分散，现在的集群规模越来越大，所以节点故障、网络故障时常态，而且要保证服务达到N个9，即保证P和A，舍弃C（退而求其次保证最终一致性）。虽然某些地方影响客户体验，但没达到造成用户流失的严重程度。

​		如果涉及钱财，C必须保证。发生网络故障宁可停止服务，保证CA，舍弃P。例如网络故障只读不写。



### 6.3BASE理论

​		BASE理论是对CAP中一致性和可用性权衡的结果，基于CAP演化而来，

​		核心思想：即使无法做到强一致性，但可根据业务，采用适当的方式来使系统达到最终一致性。与传统事物的ACID特性是相反，完全不同于ACID的强一致性，但往往会结合一起使用。

​		**基本可用（Basically Available）**：分布式系统故障时，允许损失部分可用性，即保证核心可用；

​		**软状态（Soft state）**：允许数据存在中间状态，并认为不会影响系统的整体可用性。分布式存储中一般一份数据至少有三个副本，允许不同节点间副本同步的延时就是软状态的体现。mysql rellication的异步复制也是一种体现；

​		**最终一致性（Eventually consistent）**：不需要保证实时强一致性，只需保证最终数据能一致。弱一致性和强一致性相反，最终一致性是弱一致性的一种特殊情况。



### **6.4ACID和BASE的区别与联系**

​		ACID是传统数据库的常用设计理念，追求强一致性。

​		BASE支持的是大型分布式系统，提出通过牺牲强一致性获得高可用性。

​		ACID代表了两种截然相反的设计哲学，在分布式设计场景中，系统组件对一致性要求是不同的，因此ACID和BASE又会结合使用。



## 7.如何应对高并发？

### 7.1四个指标

**响应时间（response time）**：系统对请求作出响应的时间，例如处理一个系统处理一个http请求需要200ms，200ms就是响应时间。

**吞吐量（throughput）**：单位时间内处理的请求数量；

**QPS（query per second）**：每秒响应请求数；

**并发用户数**：同时承载正常使用系统功能的用户数。



### **7.2.水平扩展（scale out）**（主要掌握）

​		只要增加服务器数量，就能线性扩充系统性能。需要在架构层进行水平扩展设计。



### **7.3垂直扩展（scale up）**

​		提升单机处理能力。方式主要有两种：

​		1.增加单机硬件性能

​		2.提升单机架构性能；例如使用异步来增加单服务吞吐量，使用无锁数据结构来减少响应时间。



## 8.Linux安装

安装Ubuntu把，mirrors address改成www.mirrors.aliyun/ubuntu

Use An Enrire Disk And Set Up LVM（选LVM未来硬盘才能扩容）

分配磁盘空间要全部用完



## 9.Linux远程管理

基于口令的安全验证：账号密码远程登录，口令和数据都是加密传输；

基于秘钥的安全验证：创建一对秘钥，公钥方远程服务器上自己的宿主目录中，私钥自己保存。



## 10.Linux目录管理

没有分区，只有磁盘概念。

/代表根目录，~代表当前用户Home目录，.代表当前目录，..代表上级目录

| 目录    | 说明                                                         |
| ------- | ------------------------------------------------------------ |
| **bin** | **存放二进制可执行文件（ls，cat，mkdir等），即命令统称为应用程序** |
| boot    | 存放用于系统引导时使用的各种文件                             |
| dev     | 存放设备文件                                                 |
| **etc** | **存放系统配置文件**                                         |
| home    | 存放所有用户文件目录                                         |
| lib     | 存放文件系统中的程序运行需要的共享库及内核模块               |
| mnt     | 系统管理员安装临时文件系统的安装点                           |
| opt     | 额外安装的可选应用程序包所放置的位置                         |
| proc    | 虚拟文件系统，存放当前内存的映射                             |
| root    | 超级用户目录                                                 |
| sbin    | 存放二进制可执行文件，只有root才能访问                       |
| tmp     | 存放临时文件                                                 |
| **usr** | **存放系统应用程序，比较重要的目录/usr/local，本地管理员手动安装软件的目录** |
| **var** | **存放运行时需要改变数据的文件**                             |

一个应程序通常包含：配置文件，数据文件，可执行文件。

例如：Mysql配置文件放/etc/mysql，数据文件放/var/mysql，可执行文件放/bin/mysql。

一个箭头>表示重写，两个箭头>>表示追加



## 11.Linux命令

### 11.1常用命令

| 命令  | 作用                   | 参数     | 参数说明                    |                          |
| ----- | ---------------------- | -------- | --------------------------- | ------------------------ |
| ls    | 显示文件和目录         |          | 只列出文件名                | ls                       |
|       |                        | -l       | 详细信息                    | ls -l                    |
|       |                        | -a       | 所有文件，包含隐藏文件      | ls -a                    |
| mkdir | 创建目录               |          |                             | mkdir 目录名             |
|       |                        | -p       | 父目录不存在则先生成父目录  | mkdir 目录名/目录名      |
| cd    | 切换目录               |          |                             | cd home                  |
| touch | 新建文件（空）         |          |                             | touch 123.txt            |
| echo  | 打印字符串             |          |                             | echo “打印内容”          |
|       |                        | >        | 重写文件                    | echo “内容” > 123.txt    |
|       |                        | &gt;&gt; | 追加内容到该文件            | echo “内容” >> 123.txt   |
| cat   | 显示文本文件内容       |          |                             |                          |
| cp    | 复制文件或目录         |          |                             |                          |
| rm    | 删除文件               |          |                             |                          |
|       |                        | -f       | 强制删除                    | rm -f 123.txt            |
|       |                        | -r       | 同时删除该目录下的所有文件  | rm -r lib                |
| mv    | 移动文件或目录         |          |                             |                          |
| find  | 查找文件               |          |                             |                          |
|       |                        | -name    | 根据文件名查找              | find 目录 -name 123.txt  |
| grep  | 指定文件中查找字符串   |          | 用cat加管道\|               | cat 123.txt \| grep 内容 |
| tree  | 树状列出文件           |          |                             |                          |
| pwd   | 显示当前工作目录       |          |                             |                          |
| ln    | 建立软链接（快捷方式） |          |                             | ln 真文件 软链接         |
| more  | 分页显示文本内容       |          |                             |                          |
| head  | 显示文件开头内容       |          |                             |                          |
| tail  | 显示文件结尾内容       |          |                             |                          |
|       |                        | -f       | 跟踪输出                    |                          |
| tar   | 解压缩（术语叫归档）   |          |                             |                          |
|       |                        | -c       | 压缩一个归档文件的参数指令  | tar -czvf 包名.tar.gz .  |
|       |                        | -x       | 解压一个归档文件的参数指令  | tar -xzvf 包名           |
|       |                        | -z       | 是否需要用gzip压缩（常用）  |                          |
|       |                        | -j       | 是否需要用bzip2压缩         |                          |
|       |                        | -v       | 压缩的过程中显示文件        |                          |
|       |                        | -f       | 指定档名，f之后要立即接档名 |                          |
|       |                        | -tf      | 查看归档文件里的文件        |                          |



### 11.2系统管理命令

 









spring-boot常用配置

https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/html/using-boot-build-systems.html